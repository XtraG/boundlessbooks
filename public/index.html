<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter Scout - Discover Your Next Story</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide-react@0.368.0/dist/lucide-react.js"></script>


    <style>
        /* Custom Styles for that 'Apple' feel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #f3f4f6; /* A slightly softer white */
        }

        /* Gradient background with animation */
        .gradient-bg {
            background: linear-gradient(-45deg, #0a0a0a, #1a1a1a, #000022, #1a001a);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Custom scrollbar for a sleek look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #4f46e5;
            border-radius: 20px;
            border: 2px solid #1a1a1a;
        }

        /* Glassmorphism effect for the header and modal */
        .glass-effect {
            background: rgba(17, 24, 39, 0.6); /* bg-gray-900 with opacity */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Input field styling */
        .custom-input, .custom-select {
            background-color: rgba(31, 41, 55, 0.5); /* bg-gray-800 with opacity */
            border: 1px solid #4b5563; /* border-gray-600 */
            color: #f3f4f6;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .custom-input:focus, .custom-select:focus {
            outline: none;
            border-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.5);
        }

        /* Card hover effect */
        .book-card, .collection-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid transparent;
        }
        .book-card:hover, .collection-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 30px -10px rgba(0, 0, 0, 0.5);
            border-color: rgba(79, 70, 229, 0.5);
        }

        /* Modal animation */
        .modal-container.hidden {
            display: none;
        }
        .modal-container {
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(50px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        /* Toast Notification */
        #toast {
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
            transform: translateY(100%);
            opacity: 0;
        }
        #toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        #ai-response-content {
            white-space: pre-wrap;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="gradient-bg">

    <!-- Header -->
    <header id="main-header" class="glass-effect fixed top-0 left-0 right-0 z-40">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-white tracking-wider">
                Boundless <span class="text-indigo-400">Books</span>
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#discover" class="text-gray-300 hover:text-white transition duration-300">Discover</a>
                <a href="#featured-reads" class="text-gray-300 hover:text-white transition duration-300">Featured Reads</a>
                <a href="#ai-guide" class="text-gray-300 hover:text-white transition duration-300">AI Guide</a>
            </div>
            <button id="my-list-btn" class="flex items-center space-x-2 border border-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-500 transition duration-300">
                <span>My List</span>
                <span id="my-list-count" class="bg-indigo-600 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </button>
        </nav>
    </header>

    <main class="pt-20">
        <!-- Hero Section -->
        <section class="min-h-[60vh] flex items-center justify-center text-center px-4 py-20">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-5xl md:text-7xl font-extrabold text-white leading-tight mb-4">
                    Discover Your Next Great Story.
                </h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-2xl mx-auto mb-8">
                    An endless library at your fingertips. We use advanced filtering and personalized recommendations to connect young readers with books they'll love.
                </p>
                <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <a href="#discover" class="w-full sm:w-auto bg-indigo-600 text-white font-semibold px-8 py-4 rounded-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105 shadow-lg shadow-indigo-600/30">Explore All Books</a>
                    <a href="#ai-guide" class="w-full sm:w-auto bg-gray-700/50 border border-gray-600 text-white font-semibold px-8 py-4 rounded-lg hover:bg-gray-700 transition duration-300 transform hover:scale-105">Ask Our AI Guide</a>
                </div>
            </div>
        </section>

        <!-- Featured Reads Section -->
        <section id="featured-reads" class="py-20 sm:py-32 px-4">
            <div class="container mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl font-bold text-white">Featured Reads</h2>
                    <p class="text-gray-400 mt-2 max-w-xl mx-auto">Great new reads to foster curiosity and adventure.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Collection Card 1 -->
                    <div data-genre="Historical Fiction" class="collection-card relative rounded-lg overflow-hidden cursor-pointer group">
                        <img src="https://placehold.co/600x400/a16207/ffffff?text=Travel\\nThrough\\nTime" alt="Historical Fiction" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500">
                        <div class="absolute inset-0 bg-black/60 group-hover:bg-black/70 transition-colors duration-300"></div>
                        <div class="absolute inset-0 p-8 flex flex-col justify-end">
                            <h3 class="text-2xl font-bold text-white">Travel Through Time</h3>
                            <p class="text-gray-300 mt-1">Journey into the past with these exciting tales.</p>
                        </div>
                    </div>
                     <!-- Collection Card 2 -->
                    <div data-genre="Graphic Novel" class="collection-card relative rounded-lg overflow-hidden cursor-pointer group">
                        <img src="https://placehold.co/600x400/f59e0b/ffffff?text=Graphic\\nNovels" alt="Graphic Novels" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500">
                        <div class="absolute inset-0 bg-black/60 group-hover:bg-black/70 transition-colors duration-300"></div>
                        <div class="absolute inset-0 p-8 flex flex-col justify-end">
                            <h3 class="text-2xl font-bold text-white">Graphic Novels For All</h3>
                            <p class="text-gray-300 mt-1">Visual storytelling that pops off the page.</p>
                        </div>
                    </div>
                     <!-- Collection Card 3 -->
                    <div data-genre="Sci-Fi" class="collection-card relative rounded-lg overflow-hidden cursor-pointer group">
                        <img src="https://placehold.co/600x400/8b5cf6/ffffff?text=Sci-Fi\\nWorlds" alt="Sci-Fi Worlds" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500">
                        <div class="absolute inset-0 bg-black/60 group-hover:bg-black/70 transition-colors duration-300"></div>
                        <div class="absolute inset-0 p-8 flex flex-col justify-end">
                            <h3 class="text-2xl font-bold text-white">Out of this World Sci-Fi</h3>
                            <p class="text-gray-300 mt-1">Explore distant galaxies and future technologies.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Reading Guide Section -->
        <section id="ai-guide" class="py-20 sm:py-32 px-4 bg-black/20">
            <div class="container mx-auto max-w-3xl text-center">
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Personalized AI Reading Guide</h2>
                <p class="text-gray-400 mb-8 max-w-2xl mx-auto">
                    Don't know where to start? Describe the reader's interests, age, and what they enjoy, and our AI will generate a personalized reading list just for you.
                </p>
                <div class="max-w-xl mx-auto space-y-4 mb-8">
                    <textarea id="ai-prompt" class="w-full h-24 p-4 rounded-lg custom-input text-base" placeholder="e.g., A funny mystery for a 7-year-old who just started reading chapter books..."></textarea>
                    <button id="generate-ai-response" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition duration-300 flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
                        <span>Generate Recommendations</span>
                    </button>
                </div>
                
                <div id="ai-response-container" class="min-h-[100px] text-left">
                     <div id="ai-loading-spinner" class="hidden text-center text-gray-400 flex flex-col items-center justify-center h-full">
                         <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-400"></div>
                         <p class="mt-4">Generating your reading list...</p>
                     </div>
                    <div id="ai-response-content" class="text-gray-300 hidden leading-relaxed bg-gray-900/50 border border-gray-800 rounded-lg p-6"></div>
                </div>
            </div>
        </section>

        <!-- Book Discovery Section -->
        <section id="discover" class="py-20 sm:py-32 px-4">
            <div class="container mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl font-bold text-white">Explore the Library</h2>
                    <p class="text-gray-400 mt-2 max-w-xl mx-auto">Use our filters to find the perfect book for any reader.</p>
                </div>

                <!-- Filters -->
                <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 mb-12 sticky top-20 z-30 backdrop-blur-sm">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                        <!-- Search Filter -->
                        <div>
                            <label for="search" class="block text-sm font-medium text-gray-300 mb-2">Search by Title or Author</label>
                            <input type="text" id="search" name="search" placeholder="e.g., Harry Potter" class="w-full p-3 rounded-lg custom-input">
                        </div>
                        <!-- Age Group Filter -->
                        <div>
                            <label for="age-group" class="block text-sm font-medium text-gray-300 mb-2">Age Group</label>
                            <select id="age-group" name="age-group" class="w-full p-3 rounded-lg custom-select appearance-none">
                                <option value="all">All Ages</option>
                                <option value="4-6">4-6 Years</option>
                                <option value="7-9">7-9 Years</option>
                                <option value="10-12">10-12 Years</option>
                                <option value="13+">13+ Years</option>
                            </select>
                        </div>
                        <!-- Reading Level Filter -->
                        <div>
                            <label for="reading-level" class="block text-sm font-medium text-gray-300 mb-2">Reading Level</label>
                            <select id="reading-level" name="reading-level" class="w-full p-3 rounded-lg custom-select appearance-none">
                                <option value="all">All Levels</option>
                                <option value="Picture Book">Picture Book</option>
                                <option value="Easy Reader">Easy Reader</option>
                                <option value="Chapter Book">Chapter Book</option>
                                <option value="Middle Grade">Middle Grade</option>
                                <option value="Young Adult">Young Adult</option>
                            </select>
                        </div>
                        <!-- Genre Filter -->
                        <div>
                             <label for="genre" class="block text-sm font-medium text-gray-300 mb-2">Genre</label>
                            <select id="genre" name="genre" class="w-full p-3 rounded-lg custom-select appearance-none">
                                 <option value="all">All Genres</option>
                                 <option value="Adventure">Adventure</option>
                                 <option value="Animal Story">Animal Story</option>
                                 <option value="Biography">Biography</option>
                                 <option value="Classic">Classic</option>
                                 <option value="Coming-of-Age">Coming-of-Age</option>
                                 <option value="Dystopian">Dystopian</option>
                                 <option value="Fantasy">Fantasy</option>
                                 <option value="Family">Family</option>
                                 <option value="Folk tale">Folk tale</option>
                                 <option value="Friendship">Friendship</option>
                                 <option value="Graphic Novel">Graphic Novel</option>
                                 <option value="Historical Fiction">Historical Fiction</option>
                                 <option value="Humor">Humor</option>
                                 <option value="Mystery">Mystery</option>
                                 <option value="Poetry">Poetry</option>
                                 <option value="Realistic Fiction">Realistic Fiction</option>
                                 <option value="Romance">Romance</option>
                                 <option value="School Story">School Story</option>
                                 <option value="Sci-Fi">Science Fiction</option>
                                 <option value="Sports">Sports</option>
                            </select>
                        </div>
                         <!-- Clear Filters Button -->
                        <div class="lg:col-span-1 flex items-end">
                            <button id="clear-filters-btn" class="w-full bg-gray-600 text-white font-semibold p-3 rounded-lg hover:bg-gray-700 transition duration-300">Clear Filters</button>
                        </div>
                    </div>
                </div>

                <!-- Results Count and Book Grid -->
                <p id="results-count" class="text-gray-400 mb-6"></p>
                <div id="book-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-8">
                    <!-- Book cards will be injected here by JavaScript -->
                </div>
                 <div id="no-results" class="hidden text-center py-20">
                     <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-x mx-auto text-gray-600 mb-4"><path d="m13.5 8.5-5 5"/><path d="m8.5 8.5 5 5"/><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <h3 class="text-2xl font-semibold text-white">No Books Found</h3>
                    <p class="text-gray-400 mt-2">Try adjusting your filters to find what you're looking for.</p>
                </div>
            </div>
        </section>
        
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-900/50 border-t border-gray-800 mt-20">
        <div class="container mx-auto px-6 py-8 text-center text-gray-400">
            <p>&copy; 2025 Chapter Scout. A project by Yash and Nate.</p>
            <p class="text-sm mt-2">Designed to foster a lifelong love for reading.</p>
        </div>
    </footer>


    <!-- Book Detail Modal -->
    <div id="book-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 modal-container">
        <div id="modal-content" class="modal-content bg-gray-900 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto relative shadow-2xl shadow-indigo-900/20 border border-gray-700">
           <!-- Content will be injected by JavaScript -->
        </div>
    </div>
    
    <!-- My List Modal -->
    <div id="my-list-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 modal-container">
        <div id="my-list-modal-content" class="modal-content bg-gray-900 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto relative shadow-2xl shadow-indigo-900/20 border border-gray-700 p-6 md:p-8">
           <!-- My List content will be injected by JavaScript -->
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-indigo-600 text-white py-3 px-6 rounded-lg shadow-lg flex items-center space-x-3 z-50">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle-2"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>
        <span id="toast-message"></span>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DATABASE ---
            const books = [
                // Existing Books
                { id: 1, title: "Awâsis and the World-Famous Bannock", author: "Dallas Hunt", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Realistic Fiction", summary: "A young Cree child, Awâsis, loses their Kôhkum's freshly made bannock. With the help of animal friends, Awâsis retraces their steps to find the treasured food.", teaser: "Follow Awâsis on a delightful adventure through the forest.", coverUrl: "https://placehold.co/400x600/6366f1/ffffff?text=Awâsis" },
                { id: 2, title: "Boxitects", author: "Kim Smith", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Realistic Fiction", summary: "Meg is a 'boxitect,' an architect who builds with boxes. When another boxitect, Simone, joins her class, they must learn to collaborate on a grand project for the annual Maker Match.", teaser: "Can two master boxitects learn to work together?", coverUrl: "https://placehold.co/400x600/7c3aed/ffffff?text=Boxitects" },
                { id: 3, title: "Change Sings: A Children's Anthem", author: "Amanda Gorman", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Poetry", summary: "Presidential Inaugural Poet Amanda Gorman shares a lyrical anthem about a young girl who leads a cast of characters on a musical journey, showing that they have the power to make changes in the world.", teaser: "I can hear change humming, in its loudest, proudest song.", coverUrl: "https://placehold.co/400x600/f59e0b/ffffff?text=Change+Sings" },
                { id: 4, title: "Choosing Brave", author: "Angela Joy", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Biography", summary: "The story of how a girl, inspired by the Little Rock Nine, chooses to be brave and be the first to integrate her school.", teaser: "A powerful story about the courage of children.", coverUrl: "https://placehold.co/400x600/10b981/ffffff?text=Choosing+Brave" },
                { id: 5, title: "Eyes That Kiss in the Corners", author: "Joanna Ho", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Realistic Fiction", summary: "A young Asian girl notices that her eyes look different from her peers'. She learns to recognize her own beauty and celebrate the legacy of her family.", teaser: "A lyrical, heartfelt celebration of Asian heritage.", coverUrl: "https://placehold.co/400x600/ec4899/ffffff?text=Eyes+That\\nKiss+in+the\\nCorners" },
                { id: 43, title: "They Both Die at the End", author: "Adam Silvera", ageGroup: "13+", readingLevel: "Young Adult", genre: "Realistic Fiction", summary: "In a world where an app can predict your death day, two boys, Mateo and Rufus, connect on their last day to live a lifetime of adventure together.", teaser: "A devastating yet uplifting story about life and loss.", coverUrl: "https://placehold.co/400x600/4f46e5/ffffff?text=They+Both\\nDie+at+the+End" },
                { id: 44, title: "Watch Us Rise", author: "Renée Watson and Ellen Hagan", ageGroup: "13+", readingLevel: "Young Adult", genre: "Realistic Fiction", summary: "Two best friends start a feminist blog and club at their high school to challenge sexism and give a voice to their fellow students, facing backlash along the way.", teaser: "A powerful story about activism and friendship.", coverUrl: "https://placehold.co/400x600/059669/ffffff?text=Watch+Us+Rise" },
                { id: 45, title: "Act (A Click Graphic Novel)", author: "Kayla Miller", ageGroup: "7-9", readingLevel: "Chapter Book", genre: "Graphic Novel", summary: "Olive is passionate about a cause and wants to make a difference. This graphic novel explores student activism, friendship, and finding your voice.", teaser: "How can one girl make a difference?", coverUrl: "https://placehold.co/400x600/d946ef/ffffff?text=Act" },
                { id: 46, title: "Class Act", author: "Jerry Craft", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Graphic Novel", summary: "The sequel to 'New Kid,' this story follows Drew, one of Jordan's friends, as he navigates the challenges of being a student of color at a prestigious private school.", teaser: "Navigating friendships and finding your place.", coverUrl: "https://placehold.co/400x600/f97316/ffffff?text=Class+Act" },
                { id: 47, title: "Dragon Hoops", author: "Gene Luen Yang", ageGroup: "13+", readingLevel: "Young Adult", genre: "Graphic Novel", summary: "A non-fiction graphic novel that follows the journey of a high school basketball team on their quest for a state championship, interwoven with the history of the sport.", teaser: "The true story of a team's journey to glory.", coverUrl: "https://placehold.co/400x600/ef4444/ffffff?text=Dragon+Hoops" },
                { id: 48, title: "Heartstopper", author: "Alice Oseman", ageGroup: "13+", readingLevel: "Young Adult", genre: "Graphic Novel", summary: "A heartwarming and wholesome graphic novel about the budding romance between two British schoolboys, Charlie and Nick, exploring themes of love, friendship, and identity.", teaser: "Boy meets boy. Boys become friends. Boys fall in love.", coverUrl: "https://placehold.co/400x600/f472b6/ffffff?text=Heartstopper" },
                { id: 55, title: "Where the Wild Things Are", author: "Maurice Sendak", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Fantasy", summary: "A young boy named Max, after being sent to his room without supper, escapes to an island inhabited by magnificent, toothy creatures known as the Wild Things.", teaser: "Let the wild rumpus start!", coverUrl: "https://placehold.co/400x600/3f3f46/ffffff?text=Where+the\\nWild+Things\\nAre" },
                { id: 56, title: "The Very Hungry Caterpillar", author: "Eric Carle", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Realistic Fiction", summary: "Follows the journey of a caterpillar as it eats its way through a wide variety of foodstuffs before pupating and emerging as a beautiful butterfly.", teaser: "He was a beautiful butterfly!", coverUrl: "https://placehold.co/400x600/4ade80/ffffff?text=The+Very\\nHungry\\nCaterpillar" },
                { id: 57, title: "Goodnight Moon", author: "Margaret Wise Brown", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Family", summary: "In a great green room, a little bunny says goodnight to all the familiar things in the softly lit room, one by one.", teaser: "Goodnight noises everywhere.", coverUrl: "https://placehold.co/400x600/94a3b8/ffffff?text=Goodnight\\nMoon" },
                { id: 58, title: "Caps for Sale", author: "Esphyr Slobodkina", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Folk tale", summary: "A peddler who balances a stack of caps on his head takes a nap under a tree, only to wake up and find his caps have been stolen by a group of mischievous monkeys.", teaser: "You monkeys, you! Give me back my caps!", coverUrl: "https://placehold.co/400x600/facc15/ffffff?text=Caps+for+Sale" },
                { id: 59, title: "The Snowy Day", author: "Ezra Jack Keats", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Realistic Fiction", summary: "A Caldecott Medal-winning story that beautifully depicts a small boy's quiet wonder and delight on a snowy day, a classic for its groundbreaking portrayal of a Black protagonist.", teaser: "The quiet magic of a city blanketed in snow.", coverUrl: "https://placehold.co/400x600/fb923c/ffffff?text=The+Snowy+Day" },
                { id: 60, title: "Corduroy", author: "Don Freeman", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Adventure", summary: "A teddy bear waiting on a department store shelf goes on a nighttime adventure to find his lost button, hoping it will help him find a home and a friend.", teaser: "A story of a small bear's big adventure.", coverUrl: "https://placehold.co/400x600/a16207/ffffff?text=Corduroy" },
                { id: 61, title: "Chicka Chicka Boom Boom", author: "Bill Martin Jr.", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Humor", summary: "The letters of the alphabet race each other up the coconut tree. Will there be enough room? A fun, rhythmic story for learning letters.", teaser: "A told B, and B told C, 'I'll meet you at the top of the coconut tree.'", coverUrl: "https://placehold.co/400x600/84cc16/ffffff?text=Chicka\\nChicka\\nBoom+Boom" },
                { id: 62, title: "Knuffle Bunny", author: "Mo Willems", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Family", summary: "A toddler named Trixie accidentally leaves her beloved stuffed bunny at the laundromat, leading to a desperate, hilarious, and heartwarming search.", teaser: "A cautionary tale about what happens when you lose your favorite bunny.", coverUrl: "https://placehold.co/400x600/d1d5db/ffffff?text=Knuffle+Bunny" },
                { id: 63, title: "The Tale of Peter Rabbit", author: "Beatrix Potter", ageGroup: "4-6", readingLevel: "Picture Book", genre: "Classic", summary: "A mischievous young rabbit disobeys his mother and sneaks into Mr. McGregor's garden, leading to a thrilling and narrow escape.", teaser: "Once upon a time there were four little Rabbits...", coverUrl: "https://placehold.co/400x600/bfdbfe/ffffff?text=The+Tale+of\\nPeter+Rabbit" },
                { id: 64, title: "Frog and Toad Are Friends", author: "Arnold Lobel", ageGroup: "7-9", readingLevel: "Easy Reader", genre: "Friendship", summary: "A collection of five heartwarming short stories that chronicle the adventures and deep friendship between a cheerful frog and a grumpy but lovable toad.", teaser: "Celebrate the power of friendship.", coverUrl: "https://placehold.co/400x600/a3e635/ffffff?text=Frog+and\\nToad" },
                { id: 65, title: "Amelia Bedelia", author: "Peggy Parish", ageGroup: "7-9", readingLevel: "Easy Reader", genre: "Humor", summary: "A literal-minded housekeeper causes comical chaos when she takes every instruction at face value, from 'dusting the furniture' to 'drawing the drapes'.", teaser: "A hilarious look at what happens when you take things too literally.", coverUrl: "https://placehold.co/400x600/fde047/ffffff?text=Amelia+Bedelia" },
                { id: 66, title: "Henry and Mudge", author: "Cynthia Rylant", ageGroup: "7-9", readingLevel: "Easy Reader", genre: "Realistic Fiction", summary: "The first book in a beloved series about a young boy named Henry and his 182-pound dog, Mudge, as they navigate the joys of pet ownership and friendship.", teaser: "The perfect beginning to a boy-and-his-dog story.", coverUrl: "https://placehold.co/400x600/fdba74/ffffff?text=Henry+and\\nMudge" },
                { id: 67, title: "Magic Tree House: Dinosaurs Before Dark", author: "Mary Pope Osborne", ageGroup: "7-9", readingLevel: "Chapter Book", genre: "Adventure", summary: "Siblings Jack and Annie discover a mysterious tree house that can transport them through time. Their first journey takes them back to the age of dinosaurs.", teaser: "Where did the tree house come from?", coverUrl: "https://placehold.co/400x600/86efac/ffffff?text=Magic+Tree\\nHouse" },
                { id: 68, title: "Nate the Great", author: "Marjorie Weinman Sharmat", ageGroup: "7-9", readingLevel: "Chapter Book", genre: "Mystery", summary: "A young, pancake-loving detective takes on his first big case: finding a friend's lost painting of her dog, Fang. He must gather clues and solve the puzzle.", teaser: "I, Nate the Great, will solve this case.", coverUrl: "https://placehold.co/400x600/fcd34d/ffffff?text=Nate+the\\nGreat" },
                { id: 69, title: "Junie B. Jones and the Stupid Smelly Bus", author: "Barbara Park", ageGroup: "7-9", readingLevel: "Chapter Book", genre: "Humor", summary: "It's kindergarten, and Junie B. Jones has a big problem. A really big problem. She does not want to ride the 'stupid smelly bus' home.", teaser: "A hilarious look at the trials of being a kindergartener.", coverUrl: "https://placehold.co/400x600/f9a8d4/ffffff?text=Junie+B.+Jones" },
                { id: 70, title: "The Berenstain Bears and the Messy Room", author: "Stan & Jan Berenstain", ageGroup: "7-9", readingLevel: "Easy Reader", genre: "Family", summary: "Brother and Sister Bear's room is a disaster! Mama Bear finally has enough and teaches them a lesson about organization and responsibility.", teaser: "A classic story about the importance of cleaning up.", coverUrl: "https://placehold.co/400x600/d2b48c/ffffff?text=Berenstain\\nBears" },
                { id: 71, title: "Flat Stanley", author: "Jeff Brown", ageGroup: "7-9", readingLevel: "Chapter Book", genre: "Adventure", summary: "After a bulletin board falls on him, Stanley Lambchop is only half an inch thick! He discovers he can now be mailed in an envelope, leading to amazing adventures.", teaser: "Being flat has its advantages.", coverUrl: "https://placehold.co/400x600/b0c4de/ffffff?text=Flat+Stanley" },
                { id: 72, title: "The Boxcar Children", author: "Gertrude Chandler Warner", ageGroup: "7-9", readingLevel: "Chapter Book", genre: "Mystery", summary: "Four orphaned siblings create a home for themselves in an abandoned boxcar in the woods. They must work together to survive and solve mysteries.", teaser: "Four brave siblings and their secret home.", coverUrl: "https://placehold.co/400x600/a52a2a/ffffff?text=The+Boxcar\\nChildren" },
                { id: 73, title: "Ivy and Bean", author: "Annie Barrows", ageGroup: "7-9", readingLevel: "Chapter Book", genre: "Friendship", summary: "Two girls who think they have nothing in common, loud Ivy and quiet Bean, discover they are destined to be best friends after a magical prank goes awry.", teaser: "Sometimes the best friends are the ones you least expect.", coverUrl: "https://placehold.co/400x600/c084fc/ffffff?text=Ivy+and+Bean" },
                { id: 74, title: "Charlotte's Web", author: "E.B. White", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Classic", summary: "A clever spider named Charlotte weaves words into her web to save her friend Wilbur, a humble pig, from becoming bacon.", teaser: "A timeless story of friendship, life, and death.", coverUrl: "https://placehold.co/400x600/fbcfe8/ffffff?text=Charlotte's\\nWeb" },
                { id: 75, title: "The One and Only Ivan", author: "Katherine Applegate", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Animal Story", summary: "Inspired by a true story, this novel is narrated by a gorilla named Ivan who has spent years in a shopping mall cage. He begins to see his home in a new light when a baby elephant arrives.", teaser: "A story about the power of friendship and the meaning of home.", coverUrl: "https://placehold.co/400x600/9ca3af/ffffff?text=The+One+\\nand+Only\\nIvan" },
                { id: 76, title: "Matilda", author: "Roald Dahl", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Fantasy", summary: "Matilda is a brilliant girl with neglectful parents and a tyrannical headmistress. She discovers she has the power of telekinesis and uses it to fight back.", teaser: "A magical story about a very special little girl.", coverUrl: "https://placehold.co/400x600/a78bfa/ffffff?text=Matilda" },
                { id: 77, title: "The Tale of Despereaux", author: "Kate DiCamillo", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Fantasy", summary: "The story of a small mouse with big ears who is in love with a princess, a rat who loves the light, and a servant girl who wishes for more. Their fates are intertwined.", teaser: "A story of bravery, forgiveness, and soup.", coverUrl: "https://placehold.co/400x600/fef08a/ffffff?text=The+Tale+of\\nDespereaux" },
                { id: 78, title: "Because of Winn-Dixie", author: "Kate DiCamillo", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Realistic Fiction", summary: "A lonely 10-year-old girl adopts a stray dog she names Winn-Dixie. The dog's charming personality helps her make new friends in a small Florida town.", teaser: "A heartwarming story about a girl and her dog.", coverUrl: "https://placehold.co/400x600/eab308/ffffff?text=Because+of\\nWinn-Dixie" },
                { id: 79, title: "Diary of a Wimpy Kid", author: "Jeff Kinney", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Humor", summary: "Greg Heffley navigates the treacherous world of middle school, documenting his experiences in a diary (not a journal!) filled with hilarious cartoons and observations.", teaser: "It's a journal, not a diary.", coverUrl: "https://placehold.co/400x600/e5e7eb/ffffff?text=Diary+of+a\\nWimpy+Kid" },
                { id: 80, title: "Frindle", author: "Andrew Clements", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "School Story", summary: "A clever fifth-grader named Nick Allen invents a new word for 'pen'—frindle. The word takes on a life of its own, causing a national sensation and a battle of wills with his language arts teacher.", teaser: "Who says a pen has to be called a pen?", coverUrl: "https://placehold.co/400x600/60a5fa/ffffff?text=Frindle" },
                { id: 81, title: "Bridge to Terabithia", author: "Katherine Paterson", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Realistic Fiction", summary: "Two friends, Jess and Leslie, create a magical kingdom in the woods called Terabithia. Their imaginary world helps them cope with the challenges of reality until a sudden tragedy changes everything.", teaser: "A powerful story of friendship, imagination, and loss.", coverUrl: "https://placehold.co/400x600/bbf7d0/ffffff?text=Bridge+to\\nTerabithia" },
                { id: 82, title: "Holes", author: "Louis Sachar", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Mystery", summary: "Wrongfully sent to a brutal juvenile detention camp, a boy must dig a hole every day. He soon realizes they aren't just digging holes; they're digging for something specific.", teaser: "A story of fate, friendship, and buried treasure.", coverUrl: "https://placehold.co/400x600/fb923c/ffffff?text=Holes" },
                { id: 83, title: "Esperanza Rising", author: "Pam Muñoz Ryan", ageGroup: "13+", readingLevel: "Young Adult", genre: "Historical Fiction", summary: "Esperanza, a wealthy girl from Mexico, is forced to flee to a California labor camp during the Great Depression. She must learn to rise above her difficult circumstances.", teaser: "A rich story of immigration, resilience, and hope.", coverUrl: "https://placehold.co/400x600/fca5a5/ffffff?text=Esperanza\\nRising" },
                { id: 84, title: "A Wrinkle in Time", author: "Madeleine L’Engle", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Sci-Fi", summary: "Meg Murry, her brother Charles Wallace, and their friend Calvin go on a journey through space and time to rescue her scientist father from an evil force that has imprisoned him on another planet.", teaser: "A classic adventure across the universe.", coverUrl: "https://placehold.co/400x600/c4b5fd/ffffff?text=A+Wrinkle\\nin+Time" },
                { id: 85, title: "Brown Girl Dreaming", author: "Jacqueline Woodson", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Poetry", summary: "A memoir in verse about the author's childhood, growing up as an African American in the 1960s and 1970s, split between South Carolina and New York.", teaser: "A moving look at a child's search for her place in the world.", coverUrl: "https://placehold.co/400x600/e9d5ff/ffffff?text=Brown+Girl\\nDreaming" },
                { id: 86, title: "Ghost", author: "Jason Reynolds", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Sports", summary: "A boy named Castle 'Ghost' Cranshaw, a natural runner, is recruited for an elite middle school track team. He must learn to harness his speed and confront his past.", teaser: "Running from his past, or towards his future?", coverUrl: "https://placehold.co/400x600/7dd3fc/ffffff?text=Ghost" },
                { id: 87, title: "The City of Ember", author: "Jeanne DuPrau", ageGroup: "10-12", readingLevel: "Middle Grade", genre: "Dystopian", summary: "In an underground city where the lights are beginning to fail, two children discover an ancient message that may be the only way to save their people.", teaser: "When the lights go out, can they find the way?", coverUrl: "https://placehold.co/400x600/4b5563/ffffff?text=The+City\\nof+Ember" },
                { id: 88, title: "The Maze Runner", author: "James Dashner", ageGroup: "13+", readingLevel: "Young Adult", genre: "Sci-Fi", summary: "A teenager named Thomas wakes up in a massive, ever-changing maze with a group of other boys. They must work together to escape and uncover the secrets of their world.", teaser: "Remember. Survive. Run.", coverUrl: "https://placehold.co/400x600/1e40af/ffffff?text=The+Maze\\nRunner" },
                { id: 89, title: "Scythe", author: "Neal Shusterman", ageGroup: "13+", readingLevel: "Young Adult", genre: "Dystopian", summary: "In a world where humanity has conquered death, two teens must apprentice to a 'Scythe'—a person tasked with controlling the population by taking lives.", teaser: "Thou shalt kill.", coverUrl: "https://placehold.co/400x600/991b1b/ffffff?text=Scythe" },
                { id: 90, title: "Turtles All the Way Down", author: "John Green", ageGroup: "13+", readingLevel: "Young Adult", genre: "Realistic Fiction", summary: "Aza Holmes, a high school student living with obsessive-compulsive disorder, tries to solve the mystery of a fugitive billionaire while navigating her own spiraling thoughts.", teaser: "A story about the challenges of living with mental illness.", coverUrl: "https://placehold.co/400x600/16a34a/ffffff?text=Turtles+All\\nthe+Way+Down" },
                { id: 91, title: "The Book Thief", author: "Markus Zusak", ageGroup: "13+", readingLevel: "Young Adult", genre: "Historical Fiction", summary: "Narrated by Death, this is the story of Liesel Meminger, a German girl who steals books and shares them with her neighbors during the rise of Nazi Germany.", teaser: "Even Death has a heart.", coverUrl: "https://placehold.co/400x600/171717/ffffff?text=The+Book\\nThief" },
                { id: 92, title: "Fahrenheit 451", author: "Ray Bradbury", ageGroup: "13+", readingLevel: "Young Adult", genre: "Classic", summary: "In a dystopian future where books are outlawed, a firefighter whose job is to burn them begins to question his role and starts to steal books himself.", teaser: "It was a pleasure to burn.", coverUrl: "https://placehold.co/400x600/f97316/ffffff?text=Fahrenheit\\n451" },
                { id: 93, title: "The House on Mango Street", author: "Sandra Cisneros", ageGroup: "13+", readingLevel: "Young Adult", genre: "Coming-of-Age", summary: "A series of vignettes about a young Latina girl named Esperanza Cordero growing up in a Chicago neighborhood, and her dream of one day leaving it behind.", teaser: "A classic story of a young woman's journey to find her own voice.", coverUrl: "https://placehold.co/400x600/ec4899/ffffff?text=The+House\\non+Mango+St" },
                { id: 94, title: "To Kill a Mockingbird", author: "Harper Lee", ageGroup: "13+", readingLevel: "Young Adult", genre: "Classic", summary: "A timeless novel about justice, prejudice, and childhood innocence in the American South, as seen through the eyes of a young girl named Scout Finch.", teaser: "A story that explores the best and worst of human nature.", coverUrl: "https://placehold.co/400x600/78716c/ffffff?text=To+Kill+a\\nMockingbird" },
                { id: 95, title: "Everything, Everything", author: "Nicola Yoon", ageGroup: "13+", readingLevel: "Young Adult", genre: "Romance", summary: "A teenage girl who is allergic to everything and has never left her house falls in love with the boy next door, leading her to risk it all for a chance at life.", teaser: "What if you couldn't touch anything in the outside world?", coverUrl: "https://placehold.co/400x600/a855f7/ffffff?text=Everything\\nEverything" },
            ];
            
            // --- STATE MANAGEMENT ---
            let filters = {
                search: '',
                ageGroup: 'all',
                readingLevel: 'all',
                genre: 'all'
            };
            let myReadingList = [];
            let speech = new SpeechSynthesisUtterance();

            // --- DOM ELEMENTS ---
            const bookGrid = document.getElementById('book-grid');
            const resultsCount = document.getElementById('results-count');
            const noResultsDiv = document.getElementById('no-results');
            const bookModal = document.getElementById('book-modal');
            const modalContent = document.getElementById('modal-content');
            const myListModal = document.getElementById('my-list-modal');
            const myListModalContent = document.getElementById('my-list-modal-content');
            const myListBtn = document.getElementById('my-list-btn');
            const myListCount = document.getElementById('my-list-count');
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const collectionCards = document.querySelectorAll('.collection-card');
            const discoverSection = document.getElementById('discover');
            const genreFilterSelect = document.getElementById('genre');
            const searchInput = document.getElementById('search');
            const ageGroupSelect = document.getElementById('age-group');
            const readingLevelSelect = document.getElementById('reading-level');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');


            // --- RENDER & FILTER FUNCTIONS ---

            const renderBooks = (bookList) => {
                bookGrid.innerHTML = ''; // Clear existing grid
                if (bookList.length === 0) {
                    noResultsDiv.classList.remove('hidden');
                    resultsCount.textContent = 'Found 0 books matching your criteria.';
                } else {
                    noResultsDiv.classList.add('hidden');
                    resultsCount.textContent = `Showing ${bookList.length} of ${books.length} books.`;
                }

                bookList.forEach(book => {
                    const isFavorite = myReadingList.includes(book.id);
                    const card = document.createElement('div');
                    card.className = 'book-card bg-gray-900/50 rounded-lg overflow-hidden cursor-pointer flex flex-col border border-gray-800';
                    card.innerHTML = `
                        <img src="${book.coverUrl}" onerror="this.onerror=null;this.src='https://placehold.co/400x600/374151/ffffff?text=No+Image';" alt="Cover of ${book.title}" class="w-full h-auto object-cover aspect-[2/3]">
                        <div class="p-4 flex flex-col flex-grow">
                            <h3 class="font-bold text-lg text-white truncate">${book.title}</h3>
                            <p class="text-sm text-gray-400 mb-2">${book.author}</p>
                            <div class="mt-auto flex justify-between items-center pt-2">
                                <span class="text-xs font-semibold text-indigo-400 bg-indigo-900/50 px-2 py-1 rounded">${book.genre}</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="${isFavorite ? '#ef4444' : 'none'}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart text-red-500 favorite-icon-grid" data-book-id="${book.id}">
                                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                </svg>
                            </div>
                        </div>
                    `;
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.favorite-icon-grid')) {
                            openBookModal(book.id);
                        }
                    });
                    bookGrid.appendChild(card);
                });
            };

            const applyFilters = () => {
                let filteredBooks = [...books];
                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    filteredBooks = filteredBooks.filter(book => 
                        book.title.toLowerCase().includes(searchTerm) || 
                        book.author.toLowerCase().includes(searchTerm)
                    );
                }
                if (filters.ageGroup !== 'all') {
                    filteredBooks = filteredBooks.filter(book => book.ageGroup === filters.ageGroup);
                }
                if (filters.readingLevel !== 'all') {
                    filteredBooks = filteredBooks.filter(book => book.readingLevel === filters.readingLevel);
                }
                if (filters.genre !== 'all') {
                    filteredBooks = filteredBooks.filter(book => book.genre === filters.genre);
                }
                renderBooks(filteredBooks);
            };

            const resetFilters = () => {
                filters = { search: '', ageGroup: 'all', readingLevel: 'all', genre: 'all' };
                searchInput.value = '';
                ageGroupSelect.value = 'all';
                readingLevelSelect.value = 'all';
                genreFilterSelect.value = 'all';
                applyFilters();
            };

            // --- MODAL FUNCTIONS ---
            
            const openBookModal = (bookId) => {
                const book = books.find(b => b.id === bookId);
                if (!book) return;
                
                const isFavorite = myReadingList.includes(book.id);

                modalContent.innerHTML = `
                    <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition z-10">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                    <div class="grid md:grid-cols-3 gap-8 p-6 md:p-8">
                        <div class="md:col-span-1">
                            <img src="${book.coverUrl}" onerror="this.onerror=null;this.src='https://placehold.co/400x600/374151/ffffff?text=No+Image';" alt="Cover of ${book.title}" class="w-full h-auto object-cover rounded-lg shadow-lg">
                        </div>
                        <div class="md:col-span-2">
                            <h2 class="text-3xl font-bold text-white mb-1">${book.title}</h2>
                            <p class="text-lg text-gray-400 mb-4">by ${book.author}</p>
                            
                            <div class="flex flex-wrap gap-2 mb-6">
                                <span class="text-sm font-semibold text-indigo-300 bg-indigo-900/50 px-3 py-1 rounded-full">${book.ageGroup} years</span>
                                <span class="text-sm font-semibold text-teal-300 bg-teal-900/50 px-3 py-1 rounded-full">${book.readingLevel}</span>
                                <span class="text-sm font-semibold text-amber-300 bg-amber-900/50 px-3 py-1 rounded-full">${book.genre}</span>
                            </div>

                            <h3 class="text-xl font-semibold text-white mb-2">Summary</h3>
                            <p class="text-gray-300 mb-6">${book.summary}</p>
                            
                            <h3 class="text-xl font-semibold text-white mb-2">Teaser</h3>
                            <p class="text-gray-400 italic mb-6">"${book.teaser}"</p>

                            <div class="flex flex-col sm:flex-row gap-4">
                                <button id="read-aloud-btn" class="w-full sm:w-auto flex-1 bg-green-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-700 transition flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
                                    <span>Read Teaser Aloud</span>
                                </button>
                                <button id="toggle-favorite-btn" data-book-id="${book.id}" class="w-full sm:w-auto flex-1 border border-red-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-red-500 transition flex items-center justify-center space-x-2 ${isFavorite ? 'bg-red-500' : ''}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="${isFavorite ? 'white' : 'none'}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart favorite-icon-modal"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                                    <span id="favorite-btn-text">${isFavorite ? 'Remove from List' : 'Add to My List'}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                bookModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                document.getElementById('close-modal-btn').addEventListener('click', closeBookModal);
                document.getElementById('read-aloud-btn').addEventListener('click', () => speakTeaser(book.teaser));
                document.getElementById('toggle-favorite-btn').addEventListener('click', () => toggleFavorite(book.id));
            };

            const closeBookModal = () => {
                window.speechSynthesis.cancel();
                bookModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            };

            const openMyListModal = () => {
                myListModalContent.innerHTML = ''; // Clear previous content

                let content = `
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-white">My Reading List</h2>
                        <button id="close-my-list-modal-btn" class="text-gray-400 hover:text-white transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                        </button>
                    </div>
                `;

                if (myReadingList.length === 0) {
                    content += `
                        <div class="text-center py-12">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open-text mx-auto text-gray-600 mb-4"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/><path d="M6 8h2"/><path d="M6 12h2"/></svg>
                            <h3 class="text-2xl font-semibold text-white mt-4">Your List is Empty</h3>
                            <p class="text-gray-400 mt-2">Add books by clicking the heart icon!</p>
                        </div>
                    `;
                } else {
                    const listBooks = myReadingList.map(id => books.find(b => b.id === id));
                    content += '<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">';
                    listBooks.forEach(book => {
                        content += `
                            <div class="bg-gray-800/50 rounded-lg p-4 flex flex-col items-center text-center">
                                <img src="${book.coverUrl}" onerror="this.onerror=null;this.src='https://placehold.co/400x600/374151/ffffff?text=No+Image';" alt="Cover of ${book.title}" class="w-32 h-48 object-cover rounded-md mb-4 shadow-lg">
                                <h4 class="font-bold text-md text-white">${book.title}</h4>
                                <p class="text-sm text-gray-400 mb-4">${book.author}</p>
                                <button class="remove-from-list-btn w-full bg-red-600/80 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition" data-book-id="${book.id}">Remove</button>
                            </div>
                        `;
                    });
                    content += '</div>';
                }

                myListModalContent.innerHTML = content;
                myListModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                document.getElementById('close-my-list-modal-btn').addEventListener('click', closeMyListModal);
                
                // Add event listeners for all remove buttons
                document.querySelectorAll('.remove-from-list-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const bookId = parseInt(e.target.dataset.bookId);
                        toggleFavorite(bookId);
                        openMyListModal(); // Refresh the list modal content
                    });
                });
            };

            const closeMyListModal = () => {
                myListModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            };


            // --- FEATURE FUNCTIONS ---
            
            const speakTeaser = (text) => {
                window.speechSynthesis.cancel();
                speech.text = text;
                speech.volume = 1;
                speech.rate = 1;
                speech.pitch = 1;
                window.speechSynthesis.speak(speech);
            };
            
            const toggleFavorite = (bookId) => {
                const bookIndex = myReadingList.indexOf(bookId);
                if (bookIndex > -1) {
                    myReadingList.splice(bookIndex, 1);
                    showToast('Removed from My List');
                } else {
                    myReadingList.push(bookId);
                    showToast('Added to My List');
                }

                myListCount.textContent = myReadingList.length;
                applyFilters();

                const modalFavoriteBtn = document.getElementById('toggle-favorite-btn');
                if (modalFavoriteBtn && parseInt(modalFavoriteBtn.dataset.bookId) === bookId) {
                    const isFavorite = myReadingList.includes(bookId);
                    modalFavoriteBtn.classList.toggle('bg-red-500', isFavorite);
                    modalFavoriteBtn.querySelector('.favorite-icon-modal').style.fill = isFavorite ? 'white' : 'none';
                    document.getElementById('favorite-btn-text').textContent = isFavorite ? 'Remove from List' : 'Add to My List';
                }
            };
            
            const showToast = (message) => {
                toastMessage.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            };

            // --- AI GUIDE FUNCTIONS (SECURE BACKEND VERSION) ---
            const handleAIGuide = async () => {
                const userPrompt = document.getElementById('ai-prompt').value;
                const spinner = document.getElementById('ai-loading-spinner');
                const responseContent = document.getElementById('ai-response-content');

                if (!userPrompt.trim()) {
                    responseContent.textContent = 'Please enter a description to get recommendations.';
                    responseContent.classList.remove('hidden');
                    spinner.classList.add('hidden');
                    return;
                }

                responseContent.classList.add('hidden');
                spinner.classList.remove('hidden');

                const bookListForAI = books.map(b => `Title: ${b.title}, Author: ${b.author}, Summary: ${b.summary}`).join('\n');

                try {
                    // This now calls YOUR secure API endpoint, not Google's.
                    const apiResponse = await fetch('/api/recommendations', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userPrompt: userPrompt,
                            bookList: bookListForAI 
                        })
                    });

                    const result = await apiResponse.json();

                    if (!apiResponse.ok) {
                        throw new Error(result.error || `Request failed with status ${apiResponse.status}`);
                    }
                    
                    let aiResponseText = "Sorry, I couldn't generate recommendations. The AI might be temporarily unavailable.";
                    if (result.candidates && result.candidates.length > 0) {
                        aiResponseText = result.candidates[0].content.parts[0].text;
                    }
                    
                    spinner.classList.add('hidden');
                    responseContent.textContent = ''; 
                    responseContent.classList.remove('hidden');

                    let i = 0;
                    function typeWriter() {
                        if (i < aiResponseText.length) {
                             responseContent.textContent += aiResponseText.charAt(i);
                             i++;
                             setTimeout(typeWriter, 15);
                        }
                    }
                    typeWriter();

                } catch (error) {
                    console.error("AI Guide Frontend Error:", error);
                    spinner.classList.add('hidden');
                    responseContent.textContent = `Sorry, an error occurred: ${error.message}`;
                    responseContent.classList.remove('hidden');
                }
            };


            // --- EVENT LISTENERS ---

            searchInput.addEventListener('input', (e) => { filters.search = e.target.value; applyFilters(); });
            ageGroupSelect.addEventListener('change', (e) => { filters.ageGroup = e.target.value; applyFilters(); });
            readingLevelSelect.addEventListener('change', (e) => { filters.readingLevel = e.target.value; applyFilters(); });
            genreFilterSelect.addEventListener('change', (e) => { filters.genre = e.target.value; applyFilters(); });
            clearFiltersBtn.addEventListener('click', resetFilters);
            document.getElementById('generate-ai-response').addEventListener('click', handleAIGuide);
            myListBtn.addEventListener('click', openMyListModal);
            
            collectionCards.forEach(card => {
                card.addEventListener('click', () => {
                    const genre = card.dataset.genre;
                    if (genre) {
                        resetFilters();
                        genreFilterSelect.value = genre;
                        filters.genre = genre;
                        applyFilters();
                        discoverSection.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (!bookModal.classList.contains('hidden')) {
                        closeBookModal();
                    }
                    if (!myListModal.classList.contains('hidden')) {
                        closeMyListModal();
                    }
                }
            });

            bookModal.addEventListener('click', (e) => {
                if (e.target === bookModal) {
                    closeBookModal();
                }
            });

            myListModal.addEventListener('click', (e) => {
                if (e.target === myListModal) {
                    closeMyListModal();
                }
            });
            
            bookGrid.addEventListener('click', (e) => {
                const heartIcon = e.target.closest('.favorite-icon-grid');
                if (heartIcon) {
                    const bookId = parseInt(heartIcon.dataset.bookId);
                    toggleFavorite(bookId);
                }
            });

            // --- INITIALIZATION ---
            applyFilters();
        });
    </script>

</body>
</html>
